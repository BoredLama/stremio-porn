{"version":3,"sources":["../src/index.js"],"names":["STATIC_DIR","DEFAULT_ID","ID","process","env","STREMIO_PORN_ID","ENDPOINT","STREMIO_PORN_ENDPOINT","PORT","STREMIO_PORN_PORT","PROXY","STREMIO_PORN_PROXY","HTTPS_PROXY","CACHE","STREMIO_PORN_CACHE","REDIS_URL","EMAIL","STREMIO_PORN_EMAIL","IS_PROD","NODE_ENV","console","error","chalk","red","exit","availableSites","PornClient","ADAPTERS","map","a","DISPLAY_NAME","join","MANIFEST","name","id","version","pkg","description","resources","types","idPrefixes","catalogs","CATALOGS","contactEmail","logo","icon","background","behaviorHints","adult","makeResourceHandler","client","resourceName","args","response","invokeResource","err","gray","Date","toLocaleString","proxy","cache","addon","AddonBuilder","defineCatalogHandler","defineMetaHandler","defineStreamHandler","getInterface","middleware","server","http","createServer","req","res","end","log","green","on","values","endpoint","email","listen"],"mappings":"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","sourcesContent":["import http from 'http'\nimport { addonBuilder as AddonBuilder, getRouter, publishToCentral } from 'stremio-addon-sdk'\nimport serveStatic from 'serve-static'\nimport chalk from 'chalk'\nimport pkg from '../package.json'\nimport PornClient from './PornClient'\n\n// @TODO adapt methods (stream.find, meta.find, ...)\n// @TODO serveStatic not needed\n// @TODO search\n// @TODO landing\n\nconst STATIC_DIR = 'static'\nconst DEFAULT_ID = 'stremio_porn'\n\nconst ID = process.env.STREMIO_PORN_ID || DEFAULT_ID\nconst ENDPOINT = process.env.STREMIO_PORN_ENDPOINT || 'https://stremio-porn.now.sh'\nconst PORT = process.env.STREMIO_PORN_PORT || process.env.PORT || '80'\nconst PROXY = process.env.STREMIO_PORN_PROXY || process.env.HTTPS_PROXY\nconst CACHE = process.env.STREMIO_PORN_CACHE || process.env.REDIS_URL || '1'\nconst EMAIL = process.env.STREMIO_PORN_EMAIL || process.env.EMAIL\nconst IS_PROD = process.env.NODE_ENV === 'production'\n\n\nif (IS_PROD && ID === DEFAULT_ID) {\n  // eslint-disable-next-line no-console\n  console.error(\n    chalk.red(\n      '\\nWhen running in production, a non-default addon identifier must be specified\\n'\n    )\n  )\n  process.exit(1)\n}\n\nlet availableSites = PornClient.ADAPTERS.map((a) => a.DISPLAY_NAME).join(', ')\n\nconst MANIFEST = {\n  name: 'Porn+',\n  id: ID,\n  version: pkg.version,\n  description: `\\\nTime to unsheathe your sword! \\\nWatch porn videos and webcam streams from ${availableSites}\\\n`,\n  resources: ['catalog', 'meta', 'stream'],\n  types: ['movie', 'tv'],\n  idPrefixes: [PornClient.ID],\n  catalogs: PornClient.CATALOGS,\n  contactEmail: EMAIL,\n  logo: `${ENDPOINT}/logo.png`,\n  icon: `${ENDPOINT}/logo.png`,\n  background: `${ENDPOINT}/bg.jpg`,\n  behaviorHints: { adult: true },\n}\n\nfunction makeResourceHandler(client, resourceName) {\n  return async (args) => {\n    try {\n      let response = await client.invokeResource(resourceName, args)\n      return response\n    } catch (err) {\n      /* eslint-disable no-console */\n      console.error(\n        // eslint-disable-next-line prefer-template\n        chalk.gray(new Date().toLocaleString()) +\n        ' An error has occurred while processing ' +\n        `the following request to ${resourceName}:`\n      )\n      console.error(args)\n      console.error(err)\n      /* eslint-enable no-console */\n      throw err\n    }\n  }\n}\n\nlet client = new PornClient({ proxy: PROXY, cache: CACHE })\nlet addon = new AddonBuilder(MANIFEST)\n  .defineCatalogHandler(makeResourceHandler(client, 'catalog'))\n  .defineMetaHandler(makeResourceHandler(client, 'meta'))\n  .defineStreamHandler(makeResourceHandler(client, 'stream'))\n  .getInterface()\nlet middleware = getRouter(addon)\nlet server = http.createServer((req, res) => {\n  serveStatic(STATIC_DIR)(req, res, () => {\n    middleware(req, res, () => res.end())\n  })\n})\nif (IS_PROD) {\n  /* eslint-disable no-console */\n  console.log(\n    chalk.green(`Publishing to Stremio central: ${ENDPOINT}/manifest.json`)\n  )\n  publishToCentral(`${ENDPOINT}/manifest.json`)\n}\n\nserver\n  .on('listening', () => {\n    let values = {\n      endpoint: chalk.green(`${ENDPOINT}/manifest.json`),\n      id: ID === DEFAULT_ID ? chalk.red(ID) : chalk.green(ID),\n      email: EMAIL ? chalk.green(EMAIL) : chalk.red('undefined'),\n      env: IS_PROD ? chalk.green('production') : chalk.green('development'),\n      proxy: PROXY ? chalk.green(PROXY) : chalk.red('off'),\n      cache: (CACHE === '0') ?\n        chalk.red('off') :\n        chalk.green(CACHE === '1' ? 'on' : CACHE),\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(`\n    ${MANIFEST.name} Addon is listening on port ${PORT}\n\n    Endpoint:    ${values.endpoint}\n    Addon Id:    ${values.id}\n    Email:       ${values.email}\n    Environment: ${values.env}\n    Proxy:       ${values.proxy}\n    Cache:       ${values.cache}\n    `)\n  })\n  .listen(PORT)\n\n\nexport default server\n"],"file":"index.js"}